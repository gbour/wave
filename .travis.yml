sudo: required
dist: trusty
group: edge

language: erlang
otp_release:
    - 17.3
    - 17.5
    - 18.2.1

services:
    - redis-server

addons:
    apt:
        packages:
            - python-redis
            - python-twisted-web

install:
    # get deps, compile code, generates config according to choosed environment
    - DEBUG=1 make env=travis all
    #Â create autosigned certificate
    - make cert
    # need to enable TLSv1 as python2.7 do not support TLS >= 1.1
    - sed -ie "s/{versions, .*\}/{versions, ['tlsv1', 'tlsv1.1', 'tlsv1.2']}/g" .wave.travis.config
    # nyamuk is a python MQTT client used for blackbox tests
    - "git clone -b enhancement https://github.com/gbour/nyamuk.git tests/nyamuk"
    - "git clone https://github.com/gbour/twotp.git tests/twotp"

before_script:
    - kerl list installations

script:
    - make dialyze
    - ./.travis-run.sh

after_script:
    - cat /tmp/wave.tests.log
    - cat /tmp/wave.travis.log

notifications:
    email: "travis-wave@bour.cc"
